import{d as Q,r as P,c as W,a as w,w as U,v as q,t as K,b as z,F as X,o as Z,n as ee,S as te,e as ne}from"./vendor.ff80b499.js";const ae=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerpolicy&&(o.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?o.credentials="include":t.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}};ae();var R=1/1048576;function oe(e){var s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,t=Number.NEGATIVE_INFINITY,o,d,a,f,g,p;for(o=e.length;o--;)e[o][0]<s&&(s=e[o][0]),e[o][0]>l&&(l=e[o][0]),e[o][1]<i&&(i=e[o][1]),e[o][1]>t&&(t=e[o][1]);return d=l-s,a=t-i,f=Math.max(d,a),g=s+d*.5,p=i+a*.5,[[g-20*f,p-f],[g,p+20*f],[g+20*f,p-f]]}function J(e,s,i,l){var t=e[s][0],o=e[s][1],d=e[i][0],a=e[i][1],f=e[l][0],g=e[l][1],p=Math.abs(o-a),L=Math.abs(a-g),b,F,I,N,M,E,T,C,A,S;if(p<R&&L<R)throw new Error("Eek! Coincident points!");return p<R?(N=-((f-d)/(g-a)),E=(d+f)/2,C=(a+g)/2,b=(d+t)/2,F=N*(b-E)+C):L<R?(I=-((d-t)/(a-o)),M=(t+d)/2,T=(o+a)/2,b=(f+d)/2,F=I*(b-M)+T):(I=-((d-t)/(a-o)),N=-((f-d)/(g-a)),M=(t+d)/2,E=(d+f)/2,T=(o+a)/2,C=(a+g)/2,b=(I*M-N*E+C-T)/(I-N),F=p>L?I*(b-M)+T:N*(b-E)+C),A=d-b,S=a-F,{i:s,j:i,k:l,x:b,y:F,r:A*A+S*S}}function le(e){var s,i,l,t,o,d;for(i=e.length;i;)for(t=e[--i],l=e[--i],s=i;s;)if(d=e[--s],o=e[--s],l===o&&t===d||l===d&&t===o){e.splice(i,2),e.splice(s,2);break}}var ue={triangulate:function(e,s){var i=e.length,l,t,o,d,a,f,g,p,L,b,F,I;if(i<3)return[];if(e=e.slice(0),s)for(l=i;l--;)e[l]=e[l][s];for(o=new Array(i),l=i;l--;)o[l]=l;for(o.sort(function(N,M){var E=e[M][0]-e[N][0];return E!==0?E:N-M}),d=oe(e),e.push(d[0],d[1],d[2]),a=[J(e,i+0,i+1,i+2)],f=[],g=[],l=o.length;l--;g.length=0){for(I=o[l],t=a.length;t--;){if(p=e[I][0]-a[t].x,p>0&&p*p>a[t].r){f.push(a[t]),a.splice(t,1);continue}L=e[I][1]-a[t].y,!(p*p+L*L-a[t].r>R)&&(g.push(a[t].i,a[t].j,a[t].j,a[t].k,a[t].k,a[t].i),a.splice(t,1))}for(le(g),t=g.length;t;)F=g[--t],b=g[--t],a.push(J(e,b,F,I))}for(l=a.length;l--;)f.push(a[l]);for(a.length=0,l=f.length;l--;)f[l].i<i&&f[l].j<i&&f[l].k<i&&a.push(f[l].i,f[l].j,f[l].k);return a},contains:function(e,s){if(s[0]<e[0][0]&&s[0]<e[1][0]&&s[0]<e[2][0]||s[0]>e[0][0]&&s[0]>e[1][0]&&s[0]>e[2][0]||s[1]<e[0][1]&&s[1]<e[1][1]&&s[1]<e[2][1]||s[1]>e[0][1]&&s[1]>e[1][1]&&s[1]>e[2][1])return null;var i=e[1][0]-e[0][0],l=e[2][0]-e[0][0],t=e[1][1]-e[0][1],o=e[2][1]-e[0][1],d=i*o-l*t;if(d===0)return null;var a=(o*(s[0]-e[0][0])-l*(s[1]-e[0][1]))/d,f=(i*(s[1]-e[0][1])-t*(s[0]-e[0][0]))/d;return a<0||f<0||a+f>1?null:[a,f]}};const re={class:"show-box"},ie={class:"bottom-box"},se={class:"slider"},ce={class:"slider-input"},de=["min","max"],he={class:"slider-input"},fe=Q({setup(e,{expose:s}){let i={originFile:null,imageData:null,saveData:null};function l(){i={originFile:null,imageData:null,saveData:null}}function t(c,n,h,m){let u=c.data,r=(m*h+n)*4;var y=u[r],v=u[r+1],x=u[r+2],_=u[r+3];return[y,v,x,_]}function o(c){return c<1?Math.round(c*1e3)/1e3:Math.round(c)}async function d(c){let n=new Image;const h=URL.createObjectURL(c);n.src=h,await new Promise((_,D)=>{n.onload=()=>_({}),n.onerror=()=>D(Error("Image loading error"))});let u=n.width,r=n.height;const y=document.createElement("canvas");u*r>1024*1024&&(u>r?(r=1024*r/u,u=1024):(u=1024*u/r,r=1024)),y.width=u,y.height=r;const v=y.getContext("2d");if(!v)throw new Error("Could not create canvas context");return URL.revokeObjectURL(h),v.drawImage(n,0,0,n.width,n.height,0,0,u,r),v.getImageData(0,0,u,r)}const a=P(!1),f=P([0,1e3]),g=P(1),p=P(1);function L(){a.value=!1,f.value=[0,1e3],g.value=1,p.value=1}function b(c,n){let h=1,m=[],u=c.width,r=c.height,y=n.data;for(let D=0;D<r;D+=h)for(let k=0;k<u;k+=h){let B=(u*D+k)*4;var v=y[B],x=y[B+1],_=y[B+2];v+x+_<=255||m.push([k,D])}return m}function F(c,n){let h=[],m=[];for(let u=0;u<n;u++){let r=Math.floor(Math.random()*c.length);for(;m.includes(r);)r=Math.floor(Math.random()*c.length),m.push(r);h.push(c[r])}return h}function I(c,n){let h=c.width-1,m=c.height-1,u=n-4,r=[],y=[];y=[[0,0],[0,m],[h,0],[h,m]];for(let v=0;v<u;v++){let x=Math.floor(Math.random()*h),_=Math.floor(Math.random()*m),D=[x,_],k=D.toString();for(;r.includes(k);)x=Math.floor(Math.random()*h),_=Math.floor(Math.random()*m),D=[x,_],k=D.toString(),r.push(k);y.push(D)}return y}async function N(c){let n,h,m,u;i.imageData?(console.log("use cache"),n=i.imageData):(n=await d(c),i.imageData=n),h=n.width*n.height/100,f.value=[h/10,h],m=h*90,u=h*10,a.value?(m=g.value*p.value,u=g.value*(100-p.value)):ee(()=>{g.value=h,p.value=90});let y=te(n).toImageData(),v=b(n,y),x=F(v,m/100),_=I(n,u/100);return{imageData:n,pointData:_.concat(x)}}function M(){A.value.innerHTML="",S.value.innerHTML=""}async function E(c){let n=document.createElement("canvas"),h=n.getContext("2d"),{imageData:m,pointData:u}=await N(c);n.width=m.width,n.height=m.height,h.putImageData(m,0,0),A.value.appendChild(n),T(m,u)}function T(c,n){let h=document.createElement("canvas"),m=h.getContext("2d");h.width=c.width,h.height=c.height;for(var u=ue.triangulate(n),r=u.length;r;){m.beginPath(),--r,m.moveTo(n[u[r]][0],n[u[r]][1]);let y=t(c,n[u[r]][0],n[u[r]][1],c.width);--r,m.lineTo(n[u[r]][0],n[u[r]][1]);let v=t(c,n[u[r]][0],n[u[r]][1],c.width);--r,m.lineTo(n[u[r]][0],n[u[r]][1]);let x=t(c,n[u[r]][0],n[u[r]][1],c.width),_=(y[0]+v[0]+x[0])/3,D=(y[1]+v[1]+x[1])/3,k=(y[2]+v[2]+x[2])/3,B=`rgba(${_}, ${D}, ${k}, ${y[3]})`;m.fillStyle=B,m.strokeStyle=B,m.fill(),m.closePath(),m.stroke()}h.toBlob(y=>{i.saveData=y}),S.value.appendChild(h)}const C=P(),A=P(),S=P(),O=P(0),j=()=>{l(),L(),C.value.click()},V=c=>{M();let n=c.target.files;i.originFile=n,E(n[0]),c.target.value=null},Y=()=>{a.value=!0,M(),E(i.originFile)},$=()=>{a.value=!0,M(),E(i.originFile)},G=()=>{var c=document.createElement("a"),n=window.URL.createObjectURL(i.saveData);c.href=n,c.download=Math.floor(Math.random()*1e5)+".png",c.click(),window.URL.revokeObjectURL(n)},H=()=>{O.value=O.value?0:1,console.log(O.value)};return s({selectFile:j,saveToImg:G,changeFile:V,changePointNum:Y,changeMarginRandom:$,switchImg:H}),(c,n)=>(Z(),W(X,null,[w("input",{type:"file",ref_key:"selector",ref:C,style:{display:"none"},onChange:V},null,544),w("div",re,[U(w("div",{class:"origin-img img-box",ref_key:"orginImg",ref:A},null,512),[[q,O.value==0]]),U(w("div",{class:"lowpoly-img img-box",ref_key:"lowpolyImg",ref:S},null,512),[[q,O.value==1]])]),w("div",ie,[w("div",se,[w("div",ce,[w("p",null,"\u70B9\u6570 \u70B9\u6570\u8D8A\u591A\u8272\u5757\u8D8A\u5BC6\u96C6("+K(o(g.value))+")",1),U(w("input",{type:"range",min:f.value[0],max:f.value[1],"onUpdate:modelValue":n[0]||(n[0]=h=>g.value=h),onChange:Y},null,40,de),[[z,g.value]])]),w("div",he,[w("p",null,"\u8FB9\u7F18\u968F\u673A\u70B9\u6570\u6BD4,0-1\u8D8A\u5927\u8F6E\u5ED3\u8D8A\u6E05\u6670("+K(p.value/100)+")",1),U(w("input",{type:"range",min:"1","onUpdate:modelValue":n[1]||(n[1]=h=>p.value=h),onChange:$},null,544),[[z,p.value]])])]),w("div",{class:"btn-box"},[w("div",{class:"btn",onClick:j},"\u9009\u62E9\u56FE\u7247"),w("div",{class:"btn",onClick:G},"\u5B58\u4E3A\u56FE\u7247"),w("div",{class:"btn",onClick:H},"\u5207\u6362\u56FE\u7247")])])],64))}});ne(fe).mount("#app");
